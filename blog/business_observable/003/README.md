# 工作流自动化作业方案

## 现实世界的工作流场景

举一个简单的示例：

公司设计有一套流程，需要项目经理，去审批一些团队员工发起的任务，这里简化画了一个图：

![现实世界流程](./_media/现实世界流程.png)

我们可以看到，项目经理先去`查询`有没有待审批的任务，如果查到任务，则进行`审批任务`。

由于项目经理是程序员出身，觉得某些任务完全可以自动化处理，如自动判断是否符合条件，自动完成审批，于是写了一个`自动化程序`来代替自己工作，以此来提高工作效率。

![现实世界流程](./_media/自动化程序流程.png)

如上图所示，`自动化程序`不断循环`查询`待审批的任务，如果查询到任务，则进行`审批任务`。

## 自动化作业的可行性

可以看出，`自动化程序` 基本等价 `项目经理`，也就是说`自动化程序`完成了相当于`人`得工作，我们把`自动程序`叫做`机器人`可谓是非常贴切！

我们也可以看出，工作流中的`用户任务`的处理，可以让`机器人`来完成；

如果工作流中有多个`用户任务`，我们可以去定义多个`机器人`进行工作。

因此，通过工作流的自动作业是`完全可行`的。

## 基于工作流自动化作业的逻辑架构设计

接下来，我们来设计一个逻辑架构，来支撑基于工作流的自动化作业场景，如图所示：

![现实世界流程](./_media/逻辑架构.png)

架构说明：

1. 架构分为：服务层、工作流层、数据层
2. 服务层：主要由业务微服务组成，支撑业务的功能，服务层接收到用户`发起`的作业，并发送消息到消息队列
3. 工作流层：包含工作流的`自动化作业程序`，工作流的`进度查询服务`
	- 自动化作业程序接收`消息`，开始启动发起工作流实例
    - 作业程序中，根据工作流实例的用户任务，启动各个需要处理`用户任务`的`机器人`，`机器人`不断循环查询各自负责的`用户任务`。比如，某个`用户任务`的`机器人`处理完成后，工作流引擎会自动流转，其他相应的`用户任务`的`机器人`就会开始处理，如此流程自动化完成。
    - 作业过程中，工作流引擎会产生历史任务数据，通过`进度查询服务`查询到作业进度数据，结合前端渲染和日志，友好的反馈给用户进行跟踪作业情况
4. 数据层：存储业务数据、作业处理结果、工作流引擎数据
